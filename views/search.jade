//CopyRight Tag Solutions Pvt.Ltd 2013
doctype 5
html
    head(lang="en")
        title LSR
        link(rel='stylesheet', href='/stylesheets/index1.css')
        link(rel='stylesheet', href='/stylesheets/jslider.css')
        link(rel='stylesheet', href='/stylesheets/jslider.round.css')
        link(rel='stylesheet', href='/stylesheets/jquery.bxslider.css')
        link(rel="stylesheet", href='/stylesheets/colorbox.css')
        link(rel="stylesheet", href='/stylesheets/jquery.nouislider.min.css')
        script(type='text/javascript', src='/javascripts/jquery-1.7.1.js')
        script(type='text/javascript', src='/javascripts/jshashtable-2.1_src.js')
        script(type='text/javascript', src='/javascripts/jquery.numberformatter-1.2.3.js')
        script(type='text/javascript', src='/javascripts/tmpl.js')
        script(type='text/javascript', src='/javascripts/jquery.dependClass-0.1.js')
        script(type='text/javascript', src='/javascripts/draggable-0.1.js')
        script(type='text/javascript', src='/javascripts/jquery.slider.js')
        script(type='text/javascript', src='https://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer.js')
        script(type='text/javascript',src='/javascripts/main.js')
        script(type='text/javascript', src='/javascripts/jquery.bxslider.min.js')
        script(type='text/javascript', src='/javascripts/jquery.nouislider.min.js')
        script(type='text/javascript', src='/javascripts/jquery.colorbox-min.js')
        script(type='text/javascript', src='/javascripts/SearchPageScript.js')
    body
        div#bigWarpper
            div#header
                ul
                    li
                        p#logo
                            a(href="/") LSR
                    li
                        div#map
                            a(href="/search")
                                img(src="/images/map_icon.png",style="margin-right:7px")
                                | Map
                        div#list(onclick="showListView(); return false;")
                            a
                                img(src="/images/listicon_bluepng.png",style="margin-right:10px")
                                | List
                    li
                        nav#mainNav
                            ul
                                li: a(href="/", style="text-decoration: none")
                                    abbr#navText HOME
                                li: a(href="/properties", style="text-decoration: none")
                                    abbr#navText PROPERTY
                                li: a(href="/properties/add", style="text-decoration: none")
                                    abbr#navText ADD
                                li: a(class="group1", href="#box1", style="text-decoration: none")
                                    | LOGIN
            div#mainBody
                ul
                    li.propertiesListContainer
                        form#searchForm(action='/search',method='POST')
                            div#choosePropertyType
                                ul
                                    input(type='button', class='selector', id='all', value='All')
                                    input(type='button', class='selector', id='rent', value='Rent')
                                    input(type='button', class='selector', id='sale', value='Sale')
                                    input(type='button', class='selector', id='selectorLast', value='Timeshare')
                                    input(type='hidden', name='prop_type', id='chosenType', value="")
                                    script.
                                            $('.selector').click(function(){
                                                $('.selector').css('background', '#ffffff');
                                                $('.selector').css('color', '#000000');
                                                $(this).css('color', '#ffffff');
                                                $(this).css('background', '#606060');
                                                var hahaha=$(this).attr("value");

                                                //alert(hahaha);
                                                document.getElementById("chosenType").value=hahaha;
                                            });
                            p#place
                                a Location
                                br
                                input#location(type="text", name="location")

                            p#priceRange
                                a Price Range(USD)
                                br
                                input#minPrice(type="text", name="min_price",pattern="[0-9]*")
                                |to
                                input#maxPrice(type="text", name="max_price",pattern="[0-9]*")
                            p#bedRooms
                                br
                                a Bedrooms
                                br
                                //input#BedroomsSlider(type="slider", value="2", name="bedroom", style="display:block;")
                                div(style="width: 240px;height: 20px;border: 1px solid #d9d9d9;margin:0 auto;background:#fff;border-radius:3px;")
                                    div.noUiSlider(style="width: 180px;height: 20px; margin: 0 auto")
                                    script(type='text/javascript', charset='utf-8').
                                        var inp1= $('.noUiSlider').parent().find('[name="bedroom"]')
                                        $('.noUiSlider').noUiSlider({
                                        range: [1,5],
                                        start: 1,
                                        handles: 1,
                                        connect: false,
                                        step:1,
                                        serialization: {
                                        to: ["bedroom",inp1],
                                        // round to 0 decimals
                                            resolution: 1
                                        }
                                        });
                            p#bathrooms
                                br
                                a Bathrooms
                                br
                                //input#BathroomsSlider(type="slider", value="2", name="bathroom", style="display:block;")
                                div(style="width: 240px;height: 20px;border: 1px solid #d9d9d9;margin:0 auto;background:#fff;border-radius:3px;")
                                    div.noUiSlider2(style="width: 180px;height: 20px; margin: 0 auto")
                                    script(type='text/javascript', charset='utf-8').
                                               var inp2 = $('.noUiSlider').parent().find('[name="bathroom"]')
                                                $('.noUiSlider2').noUiSlider({
                                                range: [1,5],
                                                start: 1,
                                                handles: 1,
                                                connect: false,
                                                step:1,
                                                serialization: {
                                                to: ["bathroom",inp2],
                                                // round to 0 decimals
                                                    resolution: 1
                                                }
                                                });
                            div#hidingDiv
                                div#more_search
                                    div#more
                                        p More
                                    div#search
                                        input(type='submit', value='Search',id='searchButton')

                                div#bannerAd
                                    p#bannerAdText Banner Ad

                            script.
                                $(document).ready(function(){
                                    $("#more").click(function(){
                                        $("#hidingDiv").hide();
                                        $("#showingDiv").show();
                                    });
                                    $("#less").click(function(){
                                        $("#hidingDiv").show();
                                        $("#showingDiv").hide();
                                    });
                                });
                            div#showingDiv(style="display: none")
                                div#less
                                    p Less
                                p#place
                                    a Country
                                    br
                                    input#location(type="text", name="country")
                                p#place
                                    a Postal Code
                                    br
                                    input#location(type="text", name="zipcode")
                                p#place
                                    a Area Within
                                    br
                                    input#location(type="text", name="areaOfSearch")

                                div#reset
                                    a Reset
                                    div#hide_search
                                        input(type='submit', value='Search',id='searchButton',onsubmit="validateForm()")
                        li.hidelist
                            aside#mainAside
                                if routePath === "search"
                                    div#MapDiv2
                                        script.
                                            var map;
                                            var propertyList = JSON.parse( !{JSON.stringify(products)} );
                                            console.log(propertyList);
                                            function initialize() {
                                            // Initial Map Options.
                                            var mapOptions = {
                                                zoom:14,
                                                mapTypeId: google.maps.MapTypeId.ROADMAP
                                            };

                                            // Loading Map

                                            map = new google.maps.Map(document.getElementById('MapDiv2'), mapOptions);

                                            // Loading location as per Geolocation
                                            if (navigator.geolocation) {
                                            navigator.geolocation.getCurrentPosition(function (position) {
                                                console.log(propertyList[0].LatLng.latitude+"::"+propertyList[0].LatLng.longitude)
                                                console.log
                                                var pos = new google.maps.LatLng(propertyList[0].LatLng.latitude, propertyList[0].LatLng.longitude);
                                            console.log("----loading---");
                                            // Function for Clustering
                                            // Loading properties in Map using marker array from DB
                                                var markers = [];
                                                var infoWindows = [];
                                                for (var i = 0; i < propertyList.length; i++) {
                                                    var latLng = new google.maps.LatLng(propertyList[i].LatLng.latitude, propertyList[i].LatLng.longitude);
                                                    var marker = new google.maps.Marker({'position': latLng, infoWindowIndex : i});
                                                    var content = '<div id=mapHoverInfo><p style="font-size:14px">'
                                                                    +propertyList[i].address.line1+", "
                                                                    +propertyList[i].address.line2+", "
                                                                    +propertyList[i].address.city+", "
                                                                    +propertyList[i].address.zip
                                                                    +"</p>"
                                                                    +"<ul><li>"+"Type:"+propertyList[i].type+"</li>"
                                                                    +"<li>Price:"+propertyList[i].price+"</li></ul>"
                                                                    +"</div>"
                                                                    +"<div id=mapHoverInfoPicture>"
                                                                    +"<ul><li><p>Beds:"+propertyList[i].bedrooms+"</p>"
                                                                    +"<p>Baths:"+propertyList[i].bathrooms+"</p>"
                                                                    +"<p>Area:"+propertyList[i].area+"sqft</p>"
                                                                    +"<p>Built:2005</p>"
                                                                    +'<p>More:<img width=10 height=10 src="../images/blue%20arrow.png"></p></li>'
                                                                    +'<li>'+'<img width=100 height=100 src='+propertyList[i].picture.linkFront+'>'+'</li></ul></div>'
                                                                    +"<div id=mapHoverInfoOptions>"
                                                                    +'<ul><li><img width=35 height=35 src="../images/button.png"></li>'
                                                                    +'<li><img width=35 height=35 src="../images/save.png"></li>'
                                                                    +'<li><img width=35 height=35 src="../images/select.png"></li>'
                                                                    +'<li><img width=33 height=33 src="../images/messgae.png"></li></ul>'
                                                                    +"</div>";
                                                    $("#propertyPriceMap").live('click',function() {
                                                            var i = $(this).attr('class');
                                                            console.log(i);
                                                            $('#mapidHide').show();
                                                            $('#mapidHide').animate({right: "40px"}, 1500);
                                                            $("#price p").html("Price: $"+propertyList[i].price);
                                                            $("#beds").html("Beds: "+propertyList[i].bedrooms);
                                                            $("#baths").html("Baths: "+propertyList[i].bathrooms);
                                                            $("#area").html("Sqft: "+propertyList[i].area);
                                                            $("#type").html("Type: "+propertyList[i].productType);
                                                                $('.slidermap').empty();
                                                                $('.slidermap').append(
                                                                "<div class=\"bxslidermap\"> <img src="+propertyList[i].picture.linkFront+" width=100% height=270/>"
                                                                +"<img src="+propertyList[i].picture.linkBack+" width=100% height=270/>"
                                                                +"<img src="+propertyList[i].picture.linkLeft+" width=100% height=270/>"
                                                                +"<img src="+propertyList[i].picture.linkRight+" width=100% height=270/> </div>"
                                                                );
                                                            $('.bxslidermap').bxSlider({
                                                            mode: 'horizontal',
                                                            auto: true,
                                                            pause: 2000,
                                                            speed:1000,
                                                            infiniteLoop:true,
                                                            buildPager: function(slideIndex){
                                                                switch(slideIndex){
                                                                    case 0:
                                                                        return '<img src='+propertyList[i].picture.linkFront+' width=50 height=50>';
                                                                    case 1:
                                                                        return '<img src='+propertyList[i].picture.linkBack+' width=50 height=50>';
                                                                    case 2:
                                                                        return '<img src='+propertyList[i].picture.linkLeft+' width=50 height=50>';
                                                                    case 3:
                                                                        return '<img src='+propertyList[i].picture.linkRight+' width=50 height=50>';
                                                                }
                                                                }
                                                                });

                                                            return false;
                                                            });

                                                            $(document).ready(function(){
                                                                $('.bxslidermap').bxSlider({
                                                                mode: 'horizontal',
                                                                auto: true,
                                                                pause: 2000,
                                                                speed:1000,
                                                                infiniteLoop:true,
                                                                buildPager: function(slideIndex){
                                                                    switch(slideIndex){
                                                                        case 0:
                                                                            return '<img src='+propertyList[0].picture.linkFront+' width=50 height=50>';
                                                                        case 1:
                                                                            return '<img src='+propertyList[0].picture.linkBack+' width=50 height=50>';
                                                                        case 2:
                                                                            return '<img src='+propertyList[0].picture.linkLeft+' width=50 height=50>';
                                                                        case 3:
                                                                            return '<img src='+propertyList[0].picture.linkRight+' width=50 height=50>';
                                                                    }
                                                                    }
                                                                });
                                                    });
                                                    $("#moreMap").live('click',function(){
                                                        $("#mapidHide").animate({right:"-40px"},1500,$("#mapidHide").hide());
                                                        //$("#mapidHide").hide();
                                                    });
                                                    var infoWindow = new google.maps.InfoWindow({
                                                        content : content
                                                    });
                                                    google.maps.event.addListener(marker, 'click',
                                                        function(event)
                                                        {
                                                            infoWindows[this.infoWindowIndex].open(map, this);
                                                        }
                                                    );
                                                    /*
                                                    google.maps.event.addListener(marker, 'mouseout',
                                                        function(event)
                                                        {
                                                            infoWindows[this.infoWindowIndex].close();
                                                        }
                                                    );*/
                                                    infoWindows.push(infoWindow);
                                                    markers.push(marker);
                                                }
                                                var markerCluster = new MarkerClusterer(map, markers, mapOptions);
                                            // End of Clustering

                                            // Setting up the Map position.
                                                map.setCenter(pos);

                                            // Function for Places.
                                            // Not sure about Markers array please go through it when time permits
                                            // End of the Places Library

                                            // Reverse Geocoder function to get location city and state in Readable format
                                            // Also populate in area search box

                                                geocoder = new google.maps.Geocoder();
                                            var location = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
                                            geocoder.geocode({'location': location }, function (results, status) {

                                            if (status == google.maps.GeocoderStatus.OK) {
                                            //Check result 0
                                            var result = results[0];
                                            //look for locality tag and administrative_area_level_1
                                            var city = "";
                                            var state = "";
                                            var postalCode= "";
                                            for (var i = 0, len = result.address_components.length; i < len; i++) {

                                            var ac = result.address_components[i];
                                            if (ac.types.indexOf("locality") >= 0) city = ac.long_name;
                                            if (ac.types.indexOf("administrative_area_level_1") >= 0) state = ac.short_name;
                                            if (ac.types.indexOf("postal_code") >= 0) postalCode = ac.long_name;

                                            }
                                            //only report if we got Good Stuff
                                            if (city != '' && state != '') {
                                            document.getElementById("serachFunctionComboBox").value = city + ',' + state;
                                            document.getElementById("serachFunctionInputText").value = postalCode;
                                                } else {
                                                    console.log('Geocoder failed' + status)
                                                    }
                                                    }
                                                    });
                                            }, function () {
                                                handleNoGeolocation(true);
                                            });
                                            }
                                            else {
                                            handleNoGeolocation(false);
                                            }
                                            }

                                            // Test for Geolocation.

                                            function handleNoGeolocation(errorFlag) {
                                            if (errorFlag) {
                                                var content = 'Error: The Geolocation service failed.';
                                            } else {
                                                var content = 'Error: Your browser doesn\'t support geolocation.';
                                            }
                                            var options = {
                                                map: map,
                                                position: new google.maps.LatLng(60, 105),
                                                content: content
                                            };
                                            var infowindow = new google.maps.InfoWindow(options);
                                            map.setCenter(options.position);
                                            }

                                            // Loading main Javascript for Map


                                            function loadScript() {
                                                var script = document.createElement('script');
                                                script.type = 'text/javascript';
                                                script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&' +
                                                    'callback=initialize&libraries=geometry&libraries=places';
                                                document.body.appendChild(script);
                                            }

                                            window.onload = loadScript;